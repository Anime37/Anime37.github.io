<!DOCTYPE html>
<html>

<head>
    <title>Twitch Clip Player</title>
    <style>
        #clip_container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
    </style>
</head>

<body>
    <div id="clip_container">
        <!-- Create an empty iframe with an ID -->
        <iframe id="clip_frame" style="width: 800px; height: 400px;"></iframe>

        <!-- Add an input field to upload a text file containing a single clip slug -->
        <input type="file" id="fileInput" accept=".txt">

        <!-- Add an input field and a button for the user to configure the reload time -->
        <input type="number" id="reloadTime" placeholder="Reload Time (in milliseconds)">
        <button onclick="startClipRotation()">Start Clip Rotation</button>
    </div>

    <script type="text/javascript">
        // Define your parent domains
        var parentDomains = ['anime37.github.io'];

        // Function to read the file and start clip rotation
        function startClipRotation() {
            var fileInput = document.getElementById('fileInput');
            var file = fileInput.files[0];

            if (file) {
                var reader = new FileReader();
                reader.onload = function (event) {
                    var clipSlug = event.target.result.trim(); // Remove leading/trailing white space

                    if (clipSlug) {
                        // Store the file name or identifier in a browser cookie
                        document.cookie = "clipFile=" + encodeURIComponent(file.name);

                        // Get the initial reload time
                        var initialReloadTime = document.getElementById('reloadTime').value || 30000; // Default reload time: 30 seconds

                        // Set the initial interval to load the clip
                        loadClip(clipSlug);

                        // Set a recurring interval to reload the same clip
                        setInterval(function () {
                            loadClip(clipSlug);
                        }, initialReloadTime);
                    }
                };

                reader.readAsText(file);
            }
        }

        // Function to load the clip from the slug
        function loadClip(slug) {
            var srcUrl = "https://clips.twitch.tv/embed?clip=" + slug + "&autoplay=true&parent=" + parentDomains.join('&parent=');
            document.getElementById('clip_frame').setAttribute('src', srcUrl);
        }

        // Check if a file name or identifier is stored in the browser cookie
        function getStoredClipFile() {
            var name = "clipFile=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var cookieArray = decodedCookie.split(';');

            for (var i = 0; i < cookieArray.length; i++) {
                var cookie = cookieArray[i].trim();
                if (cookie.indexOf(name) === 0) {
                    return cookie.substring(name.length);
                }
            }
            return "";
        }

        // On page load, check for a stored file and load it if found
        window.onload = function () {
            var storedClipFile = getStoredClipFile();
            if (storedClipFile) {
                // Load the corresponding file if available
                var fileInput = document.getElementById('fileInput');
                fileInput.value = ''; // Clear any previously selected file to ensure the change event is triggered
                var newInput = fileInput.cloneNode(true);
                newInput.addEventListener('change', function () {
                    startClipRotation();
                });
                fileInput.parentNode.replaceChild(newInput, fileInput);
            }
        };
    </script>
</body>

</html>